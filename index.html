<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Мини‑тренажёр набора текста</title>
  <style>
    body {
      background-color: #222;
      color: #ccc;
      font-family: "Courier New", Courier, monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    #timer {
      font-size: 2rem;
      margin-bottom: 20px;
    }
    #text {
      font-size: 1.8rem;
      letter-spacing: 2px;
    }
    #text span {
      opacity: 0.3;
      transition: opacity 0.2s, color 0.2s;
    }
    /* Правильная буква становится полностью видимой */
    #text span.correct {
      opacity: 1;
      color: #fff;
    }
    /* Если буква введена с ошибкой */
    #text span.incorrect {
      opacity: 1;
      color: red;
    }
    /* Если буква еще не набрана */
    #text span.pending {
      opacity: 0.3;
    }
  </style>
</head>
<body>
  <div id="timer">30</div>
  <div id="text"></div>
  
  <script>
    // Тестовый текст – можно изменить по желанию
    const sampleText = "Быстрая коричневая лиса перепрыгнула через ленивую собаку.";
    
    let currentIndex = 0;       // индекс текущего символа
    let timerStarted = false;
    let remainingTime = 30;
    let timerInterval = null;
    
    const textContainer = document.getElementById('text');
    const timerDisplay = document.getElementById('timer');

    // Разбиваем тестовый текст на символы с обёрткой <span>
    function initText() {
      textContainer.innerHTML = "";
      currentIndex = 0;
      sampleText.split('').forEach(char => {
        const span = document.createElement('span');
        span.textContent = char;
        span.classList.add('pending'); // начальное состояние – не набрано
        textContainer.appendChild(span);
      });
    }

    // Запуск таймера (30 секунд)
    function startTimer() {
      timerInterval = setInterval(() => {
        remainingTime--;
        timerDisplay.textContent = remainingTime;
        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          document.removeEventListener('keydown', handleKeyDown);
          alert('Время вышло!');
        }
      }, 1000);
    }

    // Обработка нажатий клавиш
    function handleKeyDown(e) {
      // Если нажата клавиша Backspace – удаляем предыдущий символ и возвращаем его в состояние pending
      if (e.key === "Backspace") {
        if (currentIndex > 0) {
          currentIndex--;
          const spans = textContainer.querySelectorAll('span');
          const currentSpan = spans[currentIndex];
          currentSpan.classList.remove('correct', 'incorrect');
          currentSpan.classList.add('pending');
        }
        return;
      }
      
      // Если это не одиночный символ (например, Shift, Ctrl, Alt), игнорируем нажатие
      if (e.key.length !== 1) return;

      // Если таймер ещё не запущен – запускаем его
      if (!timerStarted) {
        timerStarted = true;
        startTimer();
      }
      
      const spans = textContainer.querySelectorAll('span');
      // Если все символы уже введены, больше ничего не делаем
      if (currentIndex >= spans.length) return;
      
      const currentSpan = spans[currentIndex];
      const expectedChar = currentSpan.textContent;
      // Сравнение без изменения регистра – можно добавить .toLowerCase() для обоих значений,
      // если хочется сравнения без учёта регистра
      if (e.key === expectedChar) {
        currentSpan.classList.remove('pending');
        currentSpan.classList.add('correct');
      } else {
        currentSpan.classList.remove('pending');
        currentSpan.classList.add('incorrect');
      }
      
      currentIndex++;
    }

    // Инициализация текста при загрузке страницы
    initText();
    // Добавляем обработчик нажатия клавиш для всего документа
    document.addEventListener('keydown', handleKeyDown);
  </script>
</body>
</html>
